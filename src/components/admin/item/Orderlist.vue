<template>
  <div>
    <div class="content">
        <!-- 公司详情 -->
        <div class="companyinfo">
            <div class="companyname">
              圣甲虫游戏鼠标概念设计
            </div>
            <div class="companydetail">
                <div class="formcont">
                    <div class="title">
                      来源平台
                    </div>
                    <div class="titlecont">
                      京东/艺火
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      客户
                    </div>
                    <div class="titlecont">
                      京东/艺火
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      服务商
                    </div>
                    <div class="titlecont">
                      京东/艺火
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      合同金额
                    </div>
                    <div class="titlecont">
                      京东/艺火
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      签约日期
                    </div>
                    <div class="titlecont">
                      京东/艺火
                    </div>
                </div>
                <div class="formcont">
                    <div class="titlelast">
                      查看客户与艺火的合同
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                    <div class="titlecontlast">
                      查看服务商与太火鸟的合同
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                </div>
            </div>
        </div>
        <!-- 阶段 -->
        <div class="progress">
          <div class="procont">
              <div class="protitle">
                  订单已完成
              </div>
              <div class="progressbar">
                  <div class="first">
                    <img src="../../../assets/images/icon/ok.png" alt="">
                  </div>
                  <div class="first">
                    <img src="../../../assets/images/icon/ok.png" alt="">
                  </div>
                  <div class="first">
                    <img src="../../../assets/images/icon/ok.png" alt="">
                  </div>
                  <div class="first">
                    <img src="../../../assets/images/icon/ok.png" alt="">
                  </div>
                  <div class="first">
                    <img src="../../../assets/images/icon/ok.png" alt="">
                  </div>
              </div>
              <div class="barcont">
                  <div class="bar_cont">
                      <p>签订合作</p>
                      <p>2019-03-23 14:21:02</p>
                  </div>
                  <div class="bar_cont">
                      <p>首付款</p>
                      <p>2019-03-23 14:21:02</p>
                      <p style="color:#FAAD15">￥116,000.00</p>
                  </div>
                  <div class="bar_cont">
                      <p>第一阶段款</p>
                      <p>2019-03-23 14:21:02</p>
                      <p style="color:#FAAD15">￥116,000.00</p>
                  </div>
                  <div class="bar_cont">
                      <p>第二阶段款</p>
                      <p>2019-03-23 14:21:02</p>
                      <p style="color:#FAAD15">￥116,000.00</p>
                  </div>
                  <div class="bar_cont">
                      <p>第三阶段款</p>
                      <p>2019-03-23 14:21:02</p>
                      <p style="color:#FAAD15">￥116,000.00</p>
                  </div>
              </div>
          </div>
        </div>
        <!-- 阶段详情 -->
        <div class="progressdetail">
          <div class="procont">
            <div class="protitle">
                第三阶段：圣甲虫游戏鼠标结构设计  <span class="statuclass">已收款</span>
            </div>
            <div class="detail">
              <!-- one -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      订单金额
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
              </div>
              <!-- two -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      支付方式
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      银行
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      交易号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       支付时间
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看支付凭证
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
              <!-- three -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      发票名称
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      发票状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      快递公司
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       快递单号
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看发票信息
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 阶段详情 -->
        <div class="progressdetail">
          <div class="procont">
            <div class="protitle">
                第二阶段：圣甲虫游戏鼠标结构设计 <span class="statuclass">已收款</span>
            </div>
            <div class="detail">
              <!-- one -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      订单金额
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
              </div>
              <!-- two -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      支付方式
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      银行
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      交易号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       支付时间
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看支付凭证
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
              <!-- three -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      发票名称
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      发票状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      快递公司
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       快递单号
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看发票信息
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 阶段详情 -->
        <div class="progressdetail">
          <div class="procont">
            <div class="protitle">
                第一阶段：圣甲虫游戏鼠标结构设计 <span class="statuclass">已收款</span>
            </div>
            <div class="detail">
              <!-- one -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      订单金额
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
              </div>
              <!-- two -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      支付方式
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      银行
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      交易号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       支付时间
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看支付凭证
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
              <!-- three -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      发票名称
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      发票状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      快递公司
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       快递单号
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看发票信息
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 阶段详情 -->
        <div class="progressdetail">
          <div class="procont">
            <div class="protitle">
                首付款 <span class="statuclass">已收款</span>
            </div>
            <div class="detail">
              <!-- one -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      订单金额
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      订单状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
              </div>
              <!-- two -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      支付方式
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      银行
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      交易号
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       支付时间
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看支付凭证
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
              <!-- three -->
              <div class="detail_cont">
                <div class="formcont">
                    <div class="title">
                      发票名称
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      发票状态
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                </div>
                <div class="formcont">
                    <div class="title">
                      快递公司
                    </div>
                    <div class="titlecont">
                      ￥28,000.00
                    </div>
                 </div>
                 <div class="formcont">
                     <div class="title">
                       快递单号
                     </div>
                     <div class="titlecont">
                       ￥28,000.00
                     </div>
                  </div>
                  <div class="formcont">
                    <div class="titlelast">
                      查看发票信息
                      <img src="../../../assets/images/icon/ArrowRightHover@2x.png" alt="">
                    </div>
                   </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
</template>

<script>
  import api from '@/api/api'
  export default {
    name: 'admin_item_list',
    data () {
      return {
        menuType: 0,
        matchCompanyDialog: false,
        itemList: [],
        tableData: [],
        currentMatchCompany: [],
        multipleSelection: [],
        isLoading: false,
        matchCompanyForm: {
          itemId: '',
          itemName: '',
          companyIds: ''
        },
        query: {
          page: 1,
          pageSize: 20,
          totalCount: 0,
          sort: 1,
          type: 0,
          source: 0,
          evt: '',
          val: '',

          test: null
        },
        msg: ''
      }
    },
    methods: {
      // 查询
      onSearch() {
        this.query.page = 1
        this.$router.push({name: this.$route.name, query: this.query})
      },
      // 多选
      handleSelectionChange(val) {
        this.multipleSelection = val
      },
      handleEdit() {
      },
      handleDelete() {
      },
      handleMatch(index, item) {
        if (item.item.status !== 2) {
          // this.$message.error('项目状态不允许推荐公司')
          // return
        }
        this.currentMatchCompany = item.designCompany
        this.matchCompanyForm.itemId = item.item.id
        this.matchCompanyForm.itemStatus = item.item.status
        this.matchCompanyForm.itemName = item.item.name
        this.matchCompanyDialog = true
      },
      addMatchCompany() {
        if (!this.matchCompanyForm.itemId || !this.matchCompanyForm.itemName || !this.matchCompanyForm.companyIds || !this.matchCompanyForm.itemStatus) {
          this.$message.error('缺少请求参数!')
          return
        }
        var companyIds = this.matchCompanyForm.companyIds.split(',')
        var self = this
        this.$http.post(api.addItemToCompany, {item_id: this.matchCompanyForm.itemId, recommend: companyIds})
          .then(function (response) {
            if (response.data.meta.status_code === 200) {
              if (self.matchCompanyForm.itemStatus === 2) {
                self.$http.post(api.ConfirmItemToCompany, {item_id: self.matchCompanyForm.itemId})
                  .then(function (response1) {
                    if (response1.data.meta.status_code === 200) {
                      self.$message.success('添加成功!')
                      self.matchCompanyDialog = false
                      return
                    } else {
                      self.$message.error(response1.data.meta.message)
                    }
                  })
                  .catch(function (error) {
                    self.$message.error(error.message)
                  })
              } else {
                self.$message.success('添加成功!')
                self.matchCompanyDialog = false
              }
            } else {
              self.$message.error(response.data.meta.message)
              return
            }
          })
          .catch(function (error) {
            self.$message.error(error.message)
          })
      },
      handleSizeChange(val) {
        this.query.pageSize = parseInt(val)
        this.loadList()
      },
      handleCurrentChange(val) {
        this.query.page = parseInt(val)
        this.$router.push({name: this.$route.name, query: this.query})
      },
      // 删除项目
      multipleDelItem() {
        if (this.multipleSelection.length === 0) {
          this.$message.error('至少选择一个要删除的项目')
          return false
        }
        var idArr = []
        for (var i = 0; i < this.multipleSelection.length; i++) {
          idArr.push(this.multipleSelection[i].item.id)
        }
        this.$http.delete(api.adminItemDeleteIds, {params: {ids: idArr}})
          .then((response) => {
            if (response.data.meta.status_code === 200) {
              for (let i = 0; i < idArr.length; i++) {
                for (let j = 0; j < this.tableData.length; j++) {
                  if (idArr[i] === this.tableData[j].item.id) {
                    this.tableData.splice(j, 1)
                  }
                }
              }
              this.$message.success('删除成功!')
            } else {
              this.$message.error(response.data.meta.message)
              return
            }
          })
          .catch((error) => {
            this.$message.error(error.message)
          })
      },
      loadList() {
        const self = this
        self.query.page = parseInt(this.$route.query.page) || 1
        self.query.sort = this.$route.query.sort || 0
        self.query.type = this.$route.query.type || 0
        self.query.source = this.$route.query.source || ''
        self.query.evt = this.$route.query.evt || '4'
        self.query.val = this.$route.query.val || ''
        this.menuType = 0
        if (self.query.type) {
          this.menuType = parseInt(self.query.type)
        }
        self.isLoading = true
        self.$http.get(api.adminItemList, {
          params: {
            page: self.query.page,
            per_page: self.query.pageSize,
            sort: self.query.sort,
            type: self.query.type,
            source: self.query.source,
            evt: self.query.evt,
            val: self.query.val
          }
        })
          .then(function (response) {
            self.isLoading = false
            self.tableData = []
            console.log(response.data)
            if (response.data.meta.status_code === 200) {
              self.itemList = response.data.data
              self.query.totalCount = parseInt(response.data.meta.pagination.total)
              for (var i = 0; i < self.itemList.length; i++) {
                var item = self.itemList[i]
                if (!item.item.user) {
                  item.item.user = {}
                }
                if (!item.item.user.account) {
                  item.item.user.account = ''
                }
                var typeLabel = ''
                if (item.item.type === 1) {
                  typeLabel = item.item.type_value + '/' + item.item.design_types_value.join(', ') + '/' + item.info.field_value + '/' + item.info.industry_value
                } else {
                  typeLabel = item.item.type_value + '/' + item.item.design_types_value.join(', ')
                }

                item['item']['type_label'] = typeLabel
                item['item']['status_label'] = '[{0}]{1}'.format(item.item.status, item.item.status_value)

                if (item.info) {
                  item['item']['locale'] = '{0}/{1}'.format(item.item.province_value, item.item.city_value)
                }
                item['item']['created_at'] = item.item.created_at.date_format().format('yyyy-MM-dd')
                self.tableData.push(item)
              } // endfor
            } else {
              self.$message.error(response.data.meta.message)
            }
          })
          .catch(function (error) {
            self.isLoading = false
            self.$message.error(error.message)
          })
      }
    },
    created: function () {
      this.loadList()
    },
    watch: {
      '$route' (to, from) {
        // 对路由变化作出响应...
        this.loadList()
      }
    }
  }
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
  .companyinfo{
    margin: 20px 0;
  }
  .companyname{
    font-size: 22px;
    margin:20px 0 40px 0;
  }
  .companydetail{
    display: flex;
    flex-direction: column;
  }
  .formcont{
    display: flex;
    margin-bottom: 20px;
  }
  .title{
    width: 120px;
    font-size: 13px;
    color: #919191;
  }
  .titlelast{
    width: 140px;
    font-size: 12px;
    color: #FF5A5F;
    display: flex;
    align-items: center;
  }
  .titlelast img{
    width: 12px;
    height: 12px;
    margin-left: 5px;
  }
  .titlecont{
    font-size: 13px;
    color: #333333;
    margin-left: 10px;
  }
  .titlecontlast{
    font-size: 12px;
    color: #FF5A5F;
    margin-left: 50px;
    display: flex;
    align-items: center;
  }
  .titlecontlast img{
    width: 12px;
    height: 12px;
    margin-left: 5px;
  }
  .protitle{
     font-size: 22px;
     color: #333333;
     display: flex;
     align-items: center;
  }
  .progress{
    border-top: 1px solid #E6E6E6;
    padding: 30px 0;
  }
  .progressbar{
    display: flex;
    border-radius: 11px;
    overflow: hidden;
    margin-top: 30px;
  }
  .first{
    flex: 1;
    text-align: center;
    background: #00AC84;
    height: 21px;
    line-height: 27px;
  }
  .first img{
    width: 14px;
    height: 14px;
  }
  .barcont{
    display: flex;
    text-align: center;
    margin-top: 5px;
  }
  .bar_cont{
    flex: 1
  }
  .bar_cont p{
    font-size: 12px;
    color:#333333;
    line-height: 22px;
  }
  .progressdetail{
    border-top: 1px solid #E6E6E6;
    padding: 30px 0;
  }
  .detail{
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
  }
  .statuclass{
    display: inline-block;
    width: 77px;
    height: 26px;
    line-height: 26px;
    background:rgba(0,172,132,1);
    border-radius:13px;
    font-family:PingFangSC-Regular;
    font-weight:400;
    color:rgba(255,255,255,1);
    font-size: 14px;
    text-align: center;
    margin-left: 20px;
  }
</style>
